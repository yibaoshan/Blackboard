Android图形系统（二）屏幕篇：是什么决定了刷新率的上限？

### 内容汇总

- 补充CRT显示原理
- 介绍CRT等显示器的刷新原理
- 能不能看到屏幕刷新的过程
- 能不能超频手机屏幕刷新率
- 总结部分，回到标题，是什么决定了刷新率的上限
  - 对于CRT显示器来说
  - 对于LCD/OLED来说

### 内容顺序

- 开篇
  - 第一篇文章介绍了某某，在本篇的开始之前，我们需要介绍下老前辈
  - 什么是CRT显示器
  - 它是如何显示的？
- 屏幕是如何刷新的
  - CRT是水平/垂直偏向板
  - LCD和OLED，有源驱动和无源驱动

对于应用开发工程师来说，虽然我们不需要写驱动程序，但是了解View最终是如何显示到屏幕上还是非常有必要的

本篇是Android图形系列的第二篇文章，依旧是一些关于屏幕的名词解释，和第一篇文章不同的是，本篇重点在于介绍不同类型的屏幕是如何刷新的

以及，从屏幕刷新原理的角度来解释，决定刷新率上限的因素有哪些？

我是概览图

### 一、显示器的鼻祖：CRT

在LCD液晶屏和OLED屏还没普及之前，我们使用的显示器大多都是CRT显示器，俗称“大屁股”显示器

小时候上微机课用的电脑显示器、家里的电视机包括游戏厅里面的街机使用的都是CRT显示器

![image_android_view_v2_crt_overview](image_android_view_v2_crt_overview.gif)

*图片来源：https://gfycat.com/courageousunhealthyirishdraughthorse-computing-recycling-backlit-cathode*

CRT显示器全称是：Cathode Ray Tube（阴极射线管），在《计算机图形学基础（第3版）》一书中详细介绍了它的工作原理：

> 图2.2给出了CRT的基本工作原理，由电子枪发射出的电子束(阴极射线)通过聚焦系统和偏转系统,射向涂覆有荧光层的屏幕上的指定位置
>
> ![image_android_view_v2_crt_dismantle_22](/Users/bob/Desktop/Bob/work/workspace/androidstudio/Blackboard/Blog/src/main/java/com/android/blog/android_view/imgs/second/image_android_view_v2_crt_dismantle_22.jpg)
>
> 在电子束轰击的每个位置，荧光层都会产生一个小亮点；由于荧光层发射的光会很快衰减，因此必须采用某种方法来保持屏幕图像
>
> 一种办法是将图形信息作为电荷分布存储在CRT上，这种电荷分布用来保持荧光粉处于激活状态
>
> 但现在使用较多的维持荧光粉亮度的办法是快速控制电子束反复重画图像，这类显示器称为刷新式CRT(refreshCRT)
>
> CRT电子枪的主要元件是受热激发的金属阴极和控制栅极(参见图2.3)通过给称为灯丝的线圈通申来加热阴极，引起受热的电子“沸腾出”阴极表面
>
> ![image_android_view_v2_crt_dismantle_23](/Users/bob/Desktop/Bob/work/workspace/androidstudio/Blackboard/Blog/src/main/java/com/android/blog/android_view/imgs/second/image_android_view_v2_crt_dismantle_23.jpg)
>
> 在CRT封装内的真空里，带负电荷的自由电子在较高的正电压的作用下加速冲向荧光屏
>
> 该加速电压可由CRT封装内靠近荧光屏处充以正电荷的金属涂层生成，或者采用加速阳极(参见图2.3)。有时，电子枪结构中把加速阳极和聚焦系统放在同一部件中
>
> 电子束的偏转受电场或磁场控制，CRT现在通常配备一个装在CRT封装外部的磁性偏转线圈，如图2.2所示
>
> 使用两对线圈，将它们成对地安装在CRT封装的颈部，一对安装在颈部的顶部和底部，另一对设置在颈部两侧。每对线圈产生的磁场造成横向偏转力，该力正交于磁场方向，也垂直于电子束的行进方向。一对线圈实现水平偏转，另一对则实现垂直偏转。调节通过线圈的电流可得到适当的偏转量
>
> ![image_android_view_v2_crt_dismantle](/Users/bob/Desktop/Bob/work/workspace/androidstudio/Blackboard/Blog/src/main/java/com/android/blog/android_view/imgs/second/image_android_view_v2_crt_dismantle.jpg)
>
> 在采用静电偏转时，则在CRT封装内安装两对平行极板，一对为水平放置，控制垂直偏转；另一对垂直放置，控制水平偏转(参见图2.4)

简单来说，CRT显示器之所以能够显示图像，是靠电子枪发射的电子束激发点亮的荧光粉实现的

#### 1、逐行扫描技术

由于荧光粉被点亮后很快会熄灭，所以想要在屏幕上呈现一幅完整的图像，电子枪就必须从上到下不停循环地激发这些点

这个从上到下扫描的过程，被称为“逐行扫描”技术

CRT显示器在诞生之初使用的就是“逐行扫描”技术，这是它的工作原理决定的

![image_android_view_v2_slow_crt](/image_android_view_v2_slow_crt.gif)

> 动图截取自《[How a TV Works in Slow Motion](https://www.youtube.com/watch?v=3BJU2drrtCM)》视频片段，他们是YouTube上的一个专门拍摄慢动作视频团队
>
> 我在原视频的基础上又放慢了播放速度，这样我们可以更加直观的观察到“逐行扫描”的过程

从图中我们可以看到，CRT显示器的扫描线是按照从左到右、从上到下的顺序一行行的扫描刷新的

而且只有扫描线到达的地方的才是发光的，所以“逐行扫描”的间隔一定要足够短，再利用人眼的“视觉暂留”现象，才能在屏幕上呈现一幅完整的图像

##### 屏幕刷新率的诞生

电子束“逐行扫描”的过程是需要时间的，这就诞生出刷新率的概念

**对于CRT显示器来说，一秒钟内电子束能够扫描出一幅完整画面的速度，就是屏幕的刷新率**

刷新率越高，人眼越不容易发觉屏幕闪烁

结合图2.2和图2.4，在CRT显示器的结构中，电子枪的位置是固定的，电子束的发射方向是由“水平/垂直偏转板”或者“磁偏转线圈”（根据偏转方案不同）来控制的，因此我们可以得出：

- 使用静电偏转方案时，水平偏转板、垂直偏转板的移动速度，决定了CRT显示器刷新率的上限
- 使用磁性偏转方案时，扫描电路提供的锯齿波电流，决定了CRT显示器刷新率的上限

#### 2、隔行扫描技术

在CRT电视机普及之后，人们想把电影也搬到广播节目当中，当时的电影还是使用“胶片放映机”来播放的

但由于广播传输带宽的限制，无法一次性传输一帧完整画面的数据，于是人们就想了个办法：

将一幅画面的数据按照奇偶数拆成两场，其中奇数行称为上场，偶数行称为下场，分成两次传输

电视机每次接收到的数据之后，先显示奇数行，再显示偶数行，如图：

![image_android_view_v2_crt_scan](/imgs/second/image_android_view_v2_crt_scan.gif)

**这里可能有同学要问了：为什么不将两次传输的数据在本地合成出一帧完整数据，再用“逐行扫描”技术来刷新屏幕呢？**

答案很简单，由于早期模拟电路没有存储单元，所以很难实现图像信息的存储，电视机接受到广播信号后直接就显示了

##### 1080p和1080i有什么区别？

隔行扫描是旧时代的产物，是市场妥协的方案，仅仅只是为了解决传输带宽不足而诞生的

现在的显示器已经不使用“隔行扫描”的技术了，但配套的拍摄端支持的格式还是向前兼容的，相机可以拍摄“隔行扫描”的视频，剪辑软件也可以输出“隔行扫描”的视频，也就是我们平时所说的1080p和1080i

p是progressive，指的是使用“逐行扫描”技术的视频

 i是interlace，指的是使用“隔行扫描”技术的视频

了解这一点对摄影爱好者可能会有所帮助，无论是在前期拍摄还是在后期导出视频，一定要选择p结尾的格式

否则，你的视频将会出现画面模糊、横纹和残影等现象

### 二、屏幕驱动方式

LCD液晶屏和OLED屏摆脱了电子枪的束缚，每个像素点的发光与否可以被单独控制，并且不需要像CRT那样，通过电路板单独控制每个像素的颜色，并且由于显示原理发生了变化，LCD/OLED像素点的颜色可以维持较长的时间不衰减

初中物理电路

#### 1、无源驱动

也叫动态驱动，不通电就不亮了

#### 2、有源驱动

也叫静态驱动，

#### 3、手机屏幕能超频吗？



### 三、结语

CRT的优势不拖影

*图片来源：[《计算机图形学基础（第3版）》](https://www.amazon.cn/dp/B07R4LNRR6)*

**1、CRT刷新机制：快速扫描**

电子枪使用的扫描方式有很多，比如直线式扫描，圆形扫描，螺旋扫描等等，我们今天要介绍的是直线式扫描中的“逐行扫描”和“隔行扫描”

- **逐行扫描**

> 逐行扫描是最原始的扫描方式，电视机诞生之初使用的就是逐行扫描
>
> 逐行扫描的意思很简单：在一块CRT的屏幕上，电子枪按照从左到右、从上到下的顺序移动发射电子束的方式就叫做逐行扫描

- **隔行扫描**

> 隔行扫描是在逐行扫描的基础上修改的，扫描的顺序依旧是从左到右、从上到下，只是把原来一行行向下扫描改成了隔一行扫描一行



如图所示，隔行扫描第一次会先扫描奇数行，第二次会扫描偶数行，两次扫描结束后才是一幅完整的图形

**隔行扫描得到的视频质量是不如逐行扫描的视频的，相比之下，隔行扫描图像的清晰度要差一些，而且还会伴有轻微的闪烁**

**这里可能有同学要问：既然隔行扫描的质量不如逐行扫描，那为什么还要发明它呢？**

**答：因为市场有需求**

- **隔行扫描的诞生背景**

> 早期的广播电视播放内容比较单一，大部分是文字广告和音乐之类的内容，电影还是使用“电影放映机”来播放的
>
> 电视机发明后，人们想把电影节目也搬到电视节目当中，但是当时的**广播电视传输带宽不够**，所以人们就想了个办法：将一幅画面的数据按照奇偶数拆成两场，其中奇数行称为上场，偶数行称为下场，分成**两次传输**
>
> 电视机每次接收到的也是半幅画面，在PAL制式和NTSC制式中，显示器接受到数据后会先显示奇数行，再显示偶数行，两次显示后凑成一幅完整的图像
>
> 再后来，DVD被发明出来，相当于电视机播放的是本地视频，广播传输的带宽不再是瓶颈，所以后来的CRT电视机逐行和隔行都支持，我们小的时候看的大屁股电视，只要带有DVD接口的都是可以兼容两种不同的扫描方式的

**2、LCD/OLED：大人 时代变了**

时间来到了1968年，第一块LCD液晶屏横空出世了

经过了36年的发展，在2004年年末爆发了液晶电视革命，LCD液晶屏幕在亮度、色域、可视角度等各种参数上都完虐老大哥CRT；和液晶屏幕比，CRT屏幕除了在刷新率上有优势外，其他方面都是弟弟

于是乎从2005年开始，夏普、松下、三菱等各大屏幕厂商都陆续宣布停产CRT显示器

2012年，随着最后一家CRT显示器厂家**彩虹电子**宣布停产，CRT时代彻底宣告落幕

..

扯远了，说回液晶屏刷新的事儿

- **驱动原理：有源驱动**

> 首先我们得知道，LCD液晶屏和OLED屏的背后都是有电路板的，那想要控制每个像素点发光显示，就需要有驱动
>
> 驱动又分为两种，一种是**无源驱动**，是指在N*N的像素矩阵由水平垂直两根线来驱动，点亮像素只需要找到它在XY的坐标轴即可，缺点是不能持续的给每个像素通电，只能通过高频的点亮/熄灭像素来维持画面，和之前介绍的PWM调光原理类似
>
> 另一种叫**有源驱动**，TFT-LCD和OLED阵营的AMOLED屏都是属于有源驱动的方式，有源驱动简单来说是在每个像素点后面加入可以单独控制发光的开关，这样每个像素点就可以单独控制了，这样做的好处也显而易见，每个像素都可以持续发光

我在网上没有查到无源驱动和有源驱动各自的市场占用率，我们常见的LCD液晶屏中的**TFT-LCD屏**，和OLED屏的**AMOLED屏**都是使用**有源驱动**的方式，所以接下来关于屏幕刷新的所有都是建立在**有源驱动**之上，也叫**有源矩阵**

- **LCD液晶屏刷新原理**

> 前面介绍了LCD屏幕的大多使用有源驱动的方式，因为有电路驱动的原因，使得屏幕上每个像素点都可以直接寻址，无需等待电子光束到来才能更新
>
> **那是不是可以理解成LCD不需要逐行扫描技术了呢？**
>
> 答案是：NO
>
> **虽然LCD屏幕可以直接寻址来更新像素点，但随着屏幕分辨率越来越高，一次性更新所有像素点的代价也变得越高**
>
> 我们来看一下屏幕驱动从显存读取数据并显示到屏幕这个过程
>
> ![image_android_view_v2_lcd_ddram](/Users/bob/Desktop/Bob/work/workspace/androidstudio/Blackboard/Blog/src/main/java/com/android/blog/android_view/imgs/second/image_android_view_v2_lcd_ddram.png)
>
> *图片来源：[《理解 LCD 屏幕的驱动原理与调试过程》](https://www.cnblogs.com/juwan/p/13069102.html)*
>
> 看上图，我们重点关注“显示内存（DDRAM）”这个词儿，后续简称显存
>
> 显存里面保存是一幅画面的帧数据，显示控制驱动每次会以一行或者多行的方式读取数据，接着去刷新屏幕像素
>
> 刷新完一帧后驱动便会进入等待状态，等待时间通常是由屏幕刷新率决定的，如果是60HZ，那等到16ms之后驱动再次开始工作

- **OLED屏刷新原理**

  > OLED的显示原理虽然比LCD液晶屏要先进一些，但是在刷新方式上和LCD基本上相同，都是**有源驱动**的方式，所以直接参考LCD液晶屏刷新原理就可以了

**3、如何才能看到屏幕刷新的过程？**

讲了这么多，可不可以观察到屏幕刷新的过程呢？感受一下显示器是如何点亮一个个像素点的？

**可以！**

YouTube上有个专门拍摄慢动作的团队：[The Slow Mo Guys](https://www.youtube.com/user/theslowmoguys)

他们在2018年发布一个叫《[How a TV Works in Slow Motion - The Slow Mo Guys](https://www.youtube.com/watch?v=3BJU2drrtCM)》的视频，视频内容就是介绍不同屏幕类型的电视在高速摄像机里是什么样子的，我截几张图大家感受一下：



****

![image_android_view_v2_slow_lcd_tv](/Users/bob/Desktop/Bob/work/workspace/androidstudio/Blackboard/Blog/src/main/java/com/android/blog/android_view/imgs/second/image_android_view_v2_slow_lcd_tv.gif)

**LCD液晶电视的截图，动图里看起来像是整副画面一起更新，实际上我用PR放慢来看是多行像素一起更新**

![image_android_view_v2_slow_lcd_phone](/Users/bob/Desktop/Bob/work/workspace/androidstudio/Blackboard/Blog/src/main/java/com/android/blog/android_view/imgs/second/image_android_view_v2_slow_lcd_phone.gif)

**动图里是使用LCD液晶屏的iPhone 7手机，原视频太小了看起来很模糊，不过依稀还是可以看到屏幕是一行行像素刷新的**

